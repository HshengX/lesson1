# 项目运行指南

## 快速开始

### 步骤 1: 确认依赖已安装

依赖应该已经安装，如果需要重新安装：

```bash
uv sync
```

### 步骤 2: 配置环境变量（必需）

**项目必须配置环境变量才能运行！**

创建 `.env` 文件（在项目根目录）：

```env
# 必需：API Key
OPENAI_API_KEY=your_api_key_here

# 必需：API Base URL（服务地址）
OPENAI_API_BASE=https://api.modelscope.cn/v1
```

### 配置示例

#### ModelScope 云端服务

```env
# 从 ModelScope 控制台获取 API Key
OPENAI_API_KEY=your_modelscope_api_key

# ModelScope 云端服务地址
OPENAI_API_BASE=https://api.modelscope.cn/v1
```

#### 其他兼容服务

```env
# 你的 API Key
OPENAI_API_KEY=your_api_key

# 服务地址
OPENAI_API_BASE=https://your-service-endpoint.com/v1
```

#### 本地服务（如果使用）

```env
# 本地服务可能不需要真实的 API Key
OPENAI_API_KEY=EMPTY

# 本地服务地址
OPENAI_API_BASE=http://localhost:8000/v1
```

**重要**：如果不配置 `.env` 文件，程序启动时会提示错误。

### 步骤 3: 运行项目

```bash
# 使用 uv run（推荐）
uv run python chatbot.py

# 或者直接使用 python（如果虚拟环境已激活）
python chatbot.py
```

## 使用说明

运行后会进入交互式聊天界面：

- 直接输入消息与机器人对话
- 输入 `quit` 或 `exit` 退出
- 输入 `clear` 清空对话历史
- 输入 `history` 查看对话历史
- 输入 `stream` 切换流式输出模式
- 输入 `model <模型名>` 切换模型（如：`model qwen2`）

## 常见问题

### 1. 配置错误

如果看到 "请设置 OPENAI_API_KEY" 或 "请设置 OPENAI_API_BASE"：

- 确保在项目根目录创建了 `.env` 文件
- 确保 `.env` 文件中包含了必需的配置项
- 检查配置值是否正确（没有多余的空格）

### 2. 连接错误

如果看到 "Connection error"：

- 检查服务是否正在运行（如果是本地服务）
- 检查 `.env` 文件中的 `OPENAI_API_BASE` 是否正确
- 检查网络连接是否正常
- 检查 API Key 是否有效

### 3. 模型不存在

如果提示模型不存在：

- 确认模型名称是否正确
- 检查该模型是否在你使用的服务中可用

### 4. 依赖问题

如果导入失败：

```bash
uv sync
```

## 测试连接

在运行主程序前，可以先测试连接：

```python
from chatbot import ChatBot

# 尝试初始化（会从 .env 读取配置）
try:
    bot = ChatBot()
    print("配置正确，连接成功！")
except ValueError as e:
    print(f"配置错误: {e}")
```

## 获取 API Key

### ModelScope

1. 访问 [ModelScope 控制台](https://www.modelscope.cn/)
2. 注册/登录账号
3. 在控制台中创建 API Key
4. 将 API Key 配置到 `.env` 文件中

### 其他服务

根据你使用的服务提供商，按照其文档获取 API Key。
